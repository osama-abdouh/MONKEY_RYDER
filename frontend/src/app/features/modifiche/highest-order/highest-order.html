<div class="highest-order-wrapper">
	<div class="toolbar">
		<button (click)="goBack()" aria-label="Torna indietro" class="back-btn">← Gestione</button>
		<h2>Dettagli Ordini</h2>
		<div style="margin-left:auto; display:flex; gap:8px; align-items:center;">
			<button (click)="togglePending()" class="refresh-btn" [attr.aria-pressed]="showOnlyPending ? 'true' : 'false'">
				{{ showOnlyPending ? 'Solo pending: ON' : 'Solo pending: OFF' }}
			</button>
			<button (click)="loadOrders()" class="refresh-btn" aria-label="Ricarica">↻</button>
		</div>
	</div>

	<div *ngIf="incomingMaxOrder" class="max-order-banner">
		<strong>Ordine più alto:</strong>
		<span>{{ formatCurrency(incomingMaxOrder?.max_order) }}</span>
		<span *ngIf="incomingMaxOrder?.first_name">— {{ incomingMaxOrder.first_name }} {{ incomingMaxOrder.last_name }}</span>
	</div>

	<div *ngIf="isLoading" class="state muted">Caricamento ordini...</div>
	<div *ngIf="error" class="state error">{{ error }}</div>
	<div *ngIf="!isLoading && !error && !orders.length" class="state muted">Nessun ordine presente.</div>

	<div *ngIf="!isLoading && !error && orders.length" class="orders-table-wrapper">
			<table class="orders-table">
				<colgroup>
					<col class="col-id" />
					<col class="col-customer" />
					<col class="col-email" />
					<col class="col-date" />
					<col class="col-status" />
					<col class="col-total" />
				</colgroup>
			<thead>
				<tr>
					<th>ID</th>
					<th>Cliente</th>
					<th>Email</th>
					<th>Data</th>
						<th>Stato</th>
					<th>Totale</th>
				</tr>
			</thead>
			<tbody>
					<tr *ngFor="let o of orders" class="order-row">
						<td class="id-col">{{ o.id_ordine }}</td>
					<td>{{ o.first_name || '-' }} {{ o.last_name || '' }}</td>
					<td>{{ o.email || '-' }}</td>
					<td>{{ o.datas | date:'short' }}</td>
						<td>
							<span class="status-badge" [ngClass]="{
								'paid': (o.stato || '').toLowerCase() === 'pagato' || (o.stato || '').toLowerCase() === 'paid',
								'pending': (o.stato || '').toLowerCase() === 'in attesa' || (o.stato || '').toLowerCase() === 'pending',
								'shipped': (o.stato || '').toLowerCase() === 'spedito' || (o.stato || '').toLowerCase() === 'shipped',
								'cancelled': (o.stato || '').toLowerCase() === 'annullato' || (o.stato || '').toLowerCase() === 'cancelled'
							}">{{ o.stato || '—' }}</span>
							<button *ngIf="(o.stato || '').toLowerCase() === 'pending' || (o.stato || '').toLowerCase() === 'in attesa'"
								class="cancel-btn"
								title="Annulla ordine"
								(click)="cancel(o)">Annulla</button>
						</td>
					<td>{{ formatCurrency(o.prezzo) }}</td>
				</tr>
			</tbody>
		</table>
	</div>
</div>
