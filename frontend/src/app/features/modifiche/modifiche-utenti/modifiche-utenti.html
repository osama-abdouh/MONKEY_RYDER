<section class="gestioni-utente full-width">
	<header class="gestioni-header">
		<h2>Gestioni utente</h2>
		<p class="muted">Gestisci gli account utente: crea, modifica o blocca gli utenti registrati.</p>

		<div class="gestion-actions">
			<button class="qa-btn primary" (click)="onNewUser()" aria-label="Nuovo utente">Nuovo utente</button>
		</div>
	</header>

	<div class="gestioni-body">
		<div class="search-row">
			<input type="search" placeholder="Cerca per nome o email..." [(ngModel)]="query" (ngModelChange)="applyFilter()" aria-label="Cerca utenti" />
		</div>

			<div class="users-list">
				<div *ngIf="loading" class="muted">Caricamento utenti...</div>
				<div *ngIf="error" class="error muted">{{ error }}</div>
				<div *ngIf="!loading && (!filteredUsers || filteredUsers.length === 0)" class="muted">Nessun utente trovato.</div>
				<table *ngIf="!loading && filteredUsers && filteredUsers.length">
				<thead>
					<tr><th>Nome</th><th>Email</th><th>Ruolo</th><th>Azioni</th></tr>
				</thead>
				<tbody>
						<tr *ngFor="let u of filteredUsers">
							<td>{{ u.first_name }} {{ u.last_name }}</td>
							<td>{{ u.email }}</td>
							<td>{{ u.role }}</td>
							<td>
								<button class="qa-btn secondary" (click)="onToggleRole(u)" [disabled]="updatingIds.has(u.user_id || u.id)">Modifica Ruolo</button>
								<button class="qa-btn danger"
									[ngClass]="{ 'suspended': u.account_status === 'suspended', 'active': u.account_status === 'active' }"
									(click)="onBlockUser(u)"
									[disabled]="updatingIds.has(u.user_id || u.id)">
									{{ (u.account_status === 'suspended') ? 'Attiva' : 'Sospendi' }}
								</button>
							</td>
						</tr>
				</tbody>
			</table>
		</div>
	</div>
</section>


