<div class="cart-page">
  <div class="container">
    <h1>Il Tuo Carrello</h1>

    <div *ngIf="cartItems.length === 0">Il carrello è vuoto.</div>

    <ul *ngIf="cartItems.length > 0" class="cart-list">
      <li *ngFor="let it of cartItems" class="cart-item">
        <div class="info">
          <div class="name">{{ it.name }}</div>
          <div class="price">{{ it.price | currency:'EUR' }}</div>
        </div>
        <div class="controls">
          <button (click)="decrease(it)">-</button>
          <span>{{ it.quantity }}</span>
          <button (click)="increase(it)">+</button>
          <button (click)="remove(it)">Elimina</button>
        </div>
      </li>
    </ul>

    <div *ngIf="cartItems.length > 0" class="summary">
      <div class="total">Totale: {{ getTotalPrice() | currency:'EUR' }}</div>
      <div class="actions">
        <button (click)="clear()">Svuota carrello</button>
        <button *ngIf="isLoggedIn" (click)="checkout()">Check out</button>
      </div>
    </div>
  </div>
</div>

<div *ngIf="showPayment" class="pay-backdrop" (click)="closePayment()">
  <div class="pay-modal" (click)="$event.stopPropagation()">
    <div class="pay-form">
      <h3>Dati di Consegna</h3>
      <label>
        Nome Completo
        <input type="text" [(ngModel)]="delivery.fullName" placeholder="Mario Rossi" />
      </label>
      <label>
        Indirizzo
        <input type="text" [(ngModel)]="delivery.address" placeholder="Via Roma, 123" />
      </label>
      <label>
        Città
        <input type="text" [(ngModel)]="delivery.city" placeholder="Roma" />
      </label>
      <label>
        CAP
        <input type="text" [(ngModel)]="delivery.postalCode" placeholder="00100" />
      </label>
      <label>
        Telefono
        <input type="text" [(ngModel)]="delivery.phone" placeholder="+39 123 456 7890" />
      </label>
    </div>
    <h3>Pagamento</h3>
    <div class="pay-form">
      <label>
        Coupon sconto
        <div class="coupon-block">
          <input type="text" [(ngModel)]="couponCode" placeholder="Inserisci coupon (es. PROMO10)" />
          <button (click)="applyCoupon()">Applica</button>
          <button *ngIf="couponApplied" (click)="removeCoupon()" style="background:#ef4444;">Rimuovi</button>
        </div>
        <div *ngIf="couponMessage" class="coupon-message" [ngClass]="{'invalid': !couponApplied}">{{ couponMessage }}</div>
      </label>

      <div class="total">Totale scontato: {{ getTotalPrice() | currency:'EUR' }}</div>

      <label>
        Nome sulla carta
        <input type="text" [(ngModel)]="payment.name" placeholder="Mario Rossi" />
      </label>
      <label>
        Numero carta
        <input type="text" [(ngModel)]="payment.number" placeholder="1234 5678 9012 3456" />
      </label>
      <div class="pay-grid">
        <label>
          Mese
          <input type="number" min="1" max="12" [(ngModel)]="payment.expiryMonth" placeholder="MM" />
        </label>
        <label>
          Anno
          <input type="number" min="2024" max="2040" [(ngModel)]="payment.expiryYear" placeholder="YYYY" />
        </label>
        <label>
          CVV
          <input type="password" maxlength="3" [(ngModel)]="payment.cvv" placeholder="123" />
        </label>
      </div>
      <div *ngIf="paymentError" class="pay-error">{{ paymentError }}</div>
    </div>
      <div class="pay-actions">
      <div class="payment-amount">Importo da pagare: <strong>{{ getTotalPrice() | currency:'EUR' }}</strong></div>
      <button (click)="closePayment()" [disabled]="paying">Annulla</button>
      <button (click)="confirmPayment()" [disabled]="paying">Conferma pagamento — Paga {{ getTotalPrice() | currency:'EUR' }}</button>
    </div>
  </div>
</div>

