<div class="gestione">
	<button class="card-button customers-card" (click)="openModifiche()" [class.selected]="selected">
			<div class="card-header" style="width:100%; display:flex; justify-content:space-between; align-items:center; gap:12px;">
				<div>
					<h2 style="margin:0">Customers</h2>
					<div class="muted" style="font-size:13px">Gestisci gli utenti registrati del sistema</div>
				</div>

				<!-- Show ModificheUtenti only when user clicks the first card -->
				<app-modifiche-utenti *ngIf="showModificheUtenti"></app-modifiche-utenti>
					<div style="display:flex; gap:8px; align-items:center">
						<div class="muted" style="font-size:13px">Totale: <strong>{{ users.length || 0 }}</strong></div>
					</div>
			</div>

			<div style="margin-top:12px; width:100%">
				<div *ngIf="loading" class="muted">Caricamento utenti...</div>
				<div *ngIf="error" class="error muted">{{ error }}</div>

				<table *ngIf="users?.length; else noUsers" class="customers-table">
					<thead>
						<tr>
							<th>First name</th>
							<th>Last name</th>
							<th>Email</th>
						</tr>
					</thead>
					<tbody>
						<tr *ngFor="let u of users">
							<td>{{u.first_name}}</td>
							<td>{{u.last_name}}</td>
							<td>{{u.email}}</td>
						</tr>
					</tbody>
				</table>
				<ng-template #noUsers>
					<p class="muted">No users found for this role.</p>
				</ng-template>
			</div>
		</button>


	<button class="card-button max-order-card" (click)="openModificheWithMaxOrder()">
		<div class="max-order-header centered">
			<h2>Highest Order</h2>
			<div class="muted">Valore massimo registrato</div>
			<div class="max-order-stat centered-stat">
				<div class="amount">{{ maxOrderResult?.max_order != null ? ('€' + (maxOrderResult?.max_order | number:'1.2-2')) : '—' }}</div>
				<div class="customer">{{ maxOrderResult?.first_name || '-' }} {{ maxOrderResult?.last_name || '' }}</div>
			</div>
		</div>

		<div class="max-order-body">
			<div *ngIf="isLoadingMaxOrder" class="muted small">Caricamento in corso...</div>
			<div *ngIf="!isLoadingMaxOrder && !maxOrderResult" class="muted small">Nessun ordine disponibile.</div>

			<div *ngIf="recentOrders && recentOrders.length" class="recent-orders">
				<div class="section-title">Ordini recenti</div>
				<ul>
					<li *ngFor="let o of recentOrders" class="recent-item">
						<span class="ro-id">#{{ o.id_ordine }}</span>
						<span class="ro-price">{{ o.price ? ('€' + (o.price | number:'1.2-2')) : 'N/A' }}</span>
						<span class="ro-date">{{ o.datas | date:'short' }}</span>
					</li>
				</ul>
			</div>
		</div>
	</button>

	<button class="card-button least-product-card" (click)="onLeastProductClick()">
		<div class="least-header">
			<h2>Lowest stock</h2>
			<div class="muted">Prodotto con scorte minime</div>
		</div>
		<div class="least-body">
			<ng-container *ngIf="leastProduct; else noLeast">
				<div class="product-row">
					<div class="product-info">
						<div class="product-name">{{ leastProduct.name }}</div>
						<div class="product-category">{{ leastProduct.category }}</div>
					</div>
					<div class="product-qty">
						<span class="qty-badge" [class.low]="leastProduct.quantity !== null && leastProduct.quantity <= 5">{{ leastProduct.quantity !== null ? leastProduct.quantity : 'N/A' }}</span>
					</div>
				</div>
			</ng-container>
			<ng-template #noLeast>
				<p>No product data available.</p>
			</ng-template>
		</div>
	</button>


	<div class="card-button quick-actions-card" aria-label="Azioni rapide">
		<h2>Azioni rapide</h2>
		<div class="quick-actions">
			<button class="qa-btn primary" (click)="onNewUser()" aria-label="Crea nuovo utente">Nuovo utente</button>
			<button class="qa-btn secondary" (click)="onTrackOrder()" aria-label="Traccia un ordine">Traccia ordine</button>
			<button class="qa-btn danger" (click)="onDeleteOrder()" aria-label="Elimina ordine">Elimina ordine</button>
		</div>
	</div>
</div>
